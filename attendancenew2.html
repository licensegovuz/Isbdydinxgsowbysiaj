<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>Система посещаемости</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
// Конфигурация Firebase с правильным URL
const firebaseConfig = {
  apiKey: "AIzaSyA6BJPmKIokJM55vk6Dn4JOc4EfZjMkm0U",
  authDomain: "timetable-662a0.firebaseapp.com",
  databaseURL: "https://timetable-662a0-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "timetable-662a0",
  storageBucket: "timetable-662a0.firebasestorage.app",
  messagingSenderId: "95153504374",
  appId: "1:95153504374:web:f8b40d404aa780b28c1f57",
  measurementId: "G-NSSDY1YHJH"
};

// Инициализация Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Конфигурация приложения
const CONFIG = {
  ADMIN_PASSWORD: "Olimjon12",
  STUDENT_PASSWORD: "student123", 
  HOURS_LIMIT: 6,
  STORAGE_KEY: "user_role",
  STORAGE_TIME: "login_time",
  CACHE_PREFIX: "attendance_cache_",
  CACHE_TIMESTAMP: "cache_timestamp",
  CACHE_DURATION: 24 * 60 * 60 * 1000 // 24 часа в миллисекундах
};

// Конфигурация Telegram
const BOT_TOKEN = "8518775921:AAHRzNb9DH93Ivq48RT4-oAwpUFlc2d7bXM";
const STORAGE_CHAT_ID = "5694924195";
const OWNER_ID = "5694924195";

// Предварительно сохраняем Chat ID для владельца
if (!localStorage.getItem(STORAGE_CHAT_ID)) {
  localStorage.setItem(STORAGE_CHAT_ID, OWNER_ID);
}

// Данные студентов
const studentNames = [
  "ABDIXOLIQOVA MUXLISA ZOKIR QIZI",
  "ABDUG'AFFOROV ABDULAZIZ SHUXRAT O'G'LI",
  "ABDUKARIMOVA GUZAL ABAYEVNA",
  "ABDULLAEV BEKZOD HAMID UǴLI",
  "ABDUVAXOBOVA DINORA TURSUNOVNA",
  "AHMEDOVA JASMINA SHUHRAT QIZI",
  "GIZATULLIN RUSTAM DAVRONOVICH",
  "ISMOILOV SHOXRUH JALOL O'G'LI",
  "IZBASKANOVA NURJAMAL RASULOVNA",
  "KOMILJONOV UBAYDULLOH ZIYODULLA O'G'LI",
  "MAMADALIYEV MUHAMMADYUSUF MUROD O'G'LI",
  "MUHAMMADJONOV NURISLOMBEK VOHIDJON O'G'LI",
  "MUXAMMADALIYEVA SHAHZODA JAXONGIR QIZI",
  "MUZAFFAROVA AFRUZA BAXROMOVNA",
  "NAZRULLAYEVA SHAHZODAXON SHERZOD QIZI",
  "NE'MATOV HUSAN BOZOR O'G'LI",
  "OQILXONOV ZAFAR ODILXON O'G'LI",
  "RAHMONOV BOBURMIRZO BAHROM O'G'LI",
  "SALOXIDINOV XUSRAVXON SADRIDINXON O'G'LI",
  "SATTOROV ABDULAZIZ ABDUJABBOR O'G'LI",
  "SAYFIDDINOV MUHAMMADSOLIH MANSUROVICH",
  "SHODMONOVA MUNISA ALISHER QIZI",
  "SOBITJONOVA KAMILA SARVAR QIZI",
  "TO'LQINOV ULUG'BEK BAXROM O'G'LI",
  "TOXIRJONOV OLIMJON UMIDJON O'G'LI",
  "TURSUNALIYEVA MUXSINAXON TO'LQINJON QIZI",
  "XAMIDULLAYEV TEMURBEK BOTIR O'G'LI",
  "XUSNIDDINOV OLIMJON BAXODIR O'G'LI",
  "ABDUBOSITOVA RUXSHONA",
  "ABDUSALIMOV FAXRIDDIN"
];

// Основная функция приложения
async function initApp() {
  const lastAccess = parseInt(localStorage.getItem(CONFIG.STORAGE_TIME) || "0", 10);
  const now = Date.now();
  const hoursPassed = (now - lastAccess) / (1000 * 60 * 60);
  const savedRole = localStorage.getItem(CONFIG.STORAGE_KEY);

  // Очищаем устаревший кэш при заходе на страницу
  clearExpiredCache();

  if (savedRole && hoursPassed < CONFIG.HOURS_LIMIT) {
    showMainInterface(savedRole);
  } else {
    localStorage.removeItem(CONFIG.STORAGE_KEY);
    showLoginScreen();
  }
}

// Очищает устаревший кэш (старше 24 часов)
function clearExpiredCache() {
  const now = Date.now();
  const keysToRemove = [];
  
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key && key.startsWith(CONFIG.CACHE_PREFIX)) {
      try {
        const item = JSON.parse(localStorage.getItem(key));
        if (now - item.timestamp > CONFIG.CACHE_DURATION) {
          keysToRemove.push(key);
        }
      } catch (e) {
        // Если данные повреждены, удаляем их
        keysToRemove.push(key);
      }
    }
  }
  
  keysToRemove.forEach(key => localStorage.removeItem(key));
  if (keysToRemove.length > 0) {
    console.log('Удален устаревший кэш:', keysToRemove.length, 'записей');
  }
}

// Сохраняет данные в кэш с временной меткой
function saveToCache(date, data) {
  const cacheKey = CONFIG.CACHE_PREFIX + date;
  const cacheItem = {
    data: data,
    timestamp: Date.now()
  };
  localStorage.setItem(cacheKey, JSON.stringify(cacheItem));
}

// Получает данные из кэша, если они не устарели
function getFromCache(date) {
  const cacheKey = CONFIG.CACHE_PREFIX + date;
  const cached = localStorage.getItem(cacheKey);
  
  if (!cached) return null;
  
  try {
    const cacheItem = JSON.parse(cached);
    const now = Date.now();
    
    // Проверяем, не устарели ли данные (24 часа)
    if (now - cacheItem.timestamp > CONFIG.CACHE_DURATION) {
      localStorage.removeItem(cacheKey);
      return null;
    }
    
    return cacheItem.data;
  } catch (e) {
    // Если данные повреждены, удаляем их
    localStorage.removeItem(cacheKey);
    return null;
  }
}

// Проверяет, есть ли актуальные данные в кэше
function hasCachedData(date) {
  return getFromCache(date) !== null;
}

// Показывает экран входа
function showLoginScreen() {
  document.body.innerHTML = `
    <div class="login-container">
      <div class="login-box">
        <h2>Вход в систему посещаемости</h2>
        <div class="role-selector">
          <button class="role-btn active" data-role="student">Студент</button>
          <button class="role-btn" data-role="admin">Староста</button>
        </div>
        <div class="login-form">
          <input type="password" id="passwordInput" placeholder="Введите пароль" />
          <button id="loginBtn">Войти</button>
          <p id="loginError" class="error-message"></p>
        </div>
        <p class="login-hint">Пароль: "student123"</p>
      </div>
    </div>
  `;

  const roleButtons = document.querySelectorAll('.role-btn');
  let selectedRole = 'student';
  
  roleButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      roleButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedRole = btn.dataset.role;
    });
  });

  document.getElementById('loginBtn').addEventListener('click', () => {
    const password = document.getElementById('passwordInput').value;
    const errorElement = document.getElementById('loginError');
    
    if ((selectedRole === 'admin' && password === CONFIG.ADMIN_PASSWORD) ||
        (selectedRole === 'student' && password === CONFIG.STUDENT_PASSWORD)) {
      
      localStorage.setItem(CONFIG.STORAGE_KEY, selectedRole);
      localStorage.setItem(CONFIG.STORAGE_TIME, String(Date.now()));
      showMainInterface(selectedRole);
    } else {
      errorElement.textContent = 'Неверный пароль!';
    }
  });

  document.getElementById('passwordInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      document.getElementById('loginBtn').click();
    }
  });
}

// Показывает основной интерфейс
function showMainInterface(userRole) {
  const isAdmin = userRole === 'admin';
  
  document.body.innerHTML = `
    <div class="container">
      <header>
        <h1>Система посещаемости</h1>
        <div class="user-info">
          <span>Вы вошли как: <strong>${isAdmin ? 'Староста' : 'Студент'}</strong></span>
          <button id="logoutBtn">Выйти</button>
        </div>
      </header>
      
      <main>
        <div class="date-section">
          <label for="date">Выберите дату:</label>
          <input type="date" id="date" value="${new Date().toISOString().split('T')[0]}">
          ${isAdmin ? '<button id="saveBtn">Сохранить и отправить</button>' : ''}
        </div>
        
        <div id="table-container">
          <table id="attendance-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Имя</th>
                <th>
                  <span class="label-text">Был</span>
                  ${isAdmin ? '<input type="checkbox" id="allCheck" class="top-checkbox">' : ''}
                </th>
              </tr>
            </thead>
            <tbody id="table-body"></tbody>
          </table>
        </div>
        
        <div id="result"></div>
      </main>
    </div>
  `;

  initTable(isAdmin);
  
  // Для студентов загружаем данные, для старосты оставляем пустую таблицу
  if (!isAdmin) {
    loadAttendanceData(document.getElementById('date').value, isAdmin);
  } else {
    showResult('Отметьте присутствующих и нажмите "Сохранить и отправить"', 'info');
  }
  
  document.getElementById('date').addEventListener('change', function() {
    if (isAdmin) {
      // Для старосты при смене даты просто очищаем таблицу
      resetCheckboxes();
      showResult('Отметьте присутствующих и нажмите "Сохранить и отправить"', 'info');
    } else {
      // Для студентов загружаем данные
      loadAttendanceData(this.value, isAdmin);
    }
  });
  
  document.getElementById('logoutBtn').addEventListener('click', function() {
    localStorage.removeItem(CONFIG.STORAGE_KEY);
    localStorage.removeItem(CONFIG.STORAGE_TIME);
    showLoginScreen();
  });

  if (isAdmin) {
    document.getElementById('saveBtn').addEventListener('click', function() {
      saveAttendanceDataAndSend(document.getElementById('date').value);
    });
  }
}

// Инициализация таблицы
function initTable(isAdmin) {
  const tableBody = document.getElementById('table-body');
  tableBody.innerHTML = '';
  
  studentNames.forEach((name, i) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td class="num">${i + 1}</td>
      <td class="name">${name}</td>
      <td class="checkbox">
        ${isAdmin 
          ? `<input type="checkbox" class="studentCheck" id="s${i}">`
          : `<span class="status-indicator" id="status${i}">-</span>`
        }
      </td>
    `;
    tableBody.appendChild(row);
  });

  if (isAdmin) {
    const allCheck = document.getElementById('allCheck');
    allCheck.addEventListener('change', function() {
      document.querySelectorAll('.studentCheck').forEach(cb => {
        cb.checked = this.checked;
      });
    });

    document.querySelectorAll('.studentCheck').forEach(cb => {
      cb.addEventListener('change', function() {
        updateAllCheckState();
      });
    });
  }
}

// Сбрасывает все чекбоксы
function resetCheckboxes() {
  document.querySelectorAll('.studentCheck').forEach(cb => {
    cb.checked = false;
  });
  updateAllCheckState();
}

// Обновляет состояние главного чекбокса
function updateAllCheckState() {
  const allCheckboxes = document.querySelectorAll('.studentCheck');
  const allChecked = Array.from(allCheckboxes).every(cb => cb.checked);
  const someChecked = Array.from(allCheckboxes).some(cb => cb.checked);
  
  const allCheck = document.getElementById('allCheck');
  if (allCheck) {
    allCheck.checked = allChecked;
    allCheck.indeterminate = someChecked && !allChecked;
  }
}

// Загружает данные о посещаемости из Firebase или кэша
function loadAttendanceData(date, isAdmin) {
  console.log('Загрузка данных для даты:', date);
  
  // Для студентов сначала проверяем кэш
  if (!isAdmin && hasCachedData(date)) {
    const cachedData = getFromCache(date);
    console.log('Данные загружены из кэша:', cachedData);
    updateAttendanceDisplay(cachedData, isAdmin);
    showResult('Данные загружены из кэша (актуальны 24 часа)', 'success');
    return;
  }
  
  // Если админ или нет в кэше, загружаем из Firebase
  const attendanceRef = database.ref('attendance/' + date);
  
  attendanceRef.once('value')
    .then(snapshot => {
      const data = snapshot.val();
      console.log('Получены данные из Firebase:', data);
      
      // Сохраняем в кэш для студентов на 24 часа только если данные есть
      if (!isAdmin && data && Object.keys(data).length > 0) {
        saveToCache(date, data);
        console.log('Данные сохранены в кэш на 24 часа');
        showResult('Данные загружены и сохранены в кэш на 24 часа', 'success');
      } else if (!isAdmin) {
        // Если данных нет, не сохраняем в кэш и показываем сообщение
        console.log('Данных нет, кэш не сохраняется');
        showResult('Данные загружены (нет информации за эту дату)', 'info');
      } else {
        showResult('Данные загружены', 'success');
      }
      
      updateAttendanceDisplay(data, isAdmin);
    })
    .catch(error => {
      console.error('Ошибка загрузки из Firebase:', error);
      showResult('Ошибка загрузки данных', 'error');
    });
}

// Обновляет отображение данных посещаемости
function updateAttendanceDisplay(data, isAdmin) {
  if (isAdmin) {
    document.querySelectorAll('.studentCheck').forEach((cb, index) => {
      if (data && data.hasOwnProperty(index)) {
        cb.checked = data[index] === true;
      } else {
        cb.checked = false;
      }
    });
    updateAllCheckState();
  } else {
    document.querySelectorAll('.status-indicator').forEach((indicator, index) => {
      const isPresent = data && data[index] === true;
      indicator.textContent = isPresent ? '✓' : '✗';
      indicator.className = `status-indicator ${isPresent ? 'present' : 'absent'}`;
    });
  }
}

// Сохраняет данные о посещаемости в Firebase
function saveAttendanceData(date) {
  return new Promise((resolve, reject) => {
    const checks = Array.from(document.querySelectorAll('.studentCheck')).map(cb => cb.checked);
    const attendanceData = {};
    
    checks.forEach((isPresent, index) => {
      attendanceData[index] = isPresent;
    });
    
    console.log('Сохранение данных в Firebase:', attendanceData);
    
    const attendanceRef = database.ref('attendance/' + date);
    
    attendanceRef.set(attendanceData)
      .then(() => {
        console.log('Данные успешно сохранены в Firebase');
        showResult('Данные сохранены в базе!', 'success');
        resolve(true);
      })
      .catch(error => {
        console.error('Ошибка сохранения в Firebase:', error);
        showResult('Ошибка сохранения данных', 'error');
        reject(error);
      });
  });
}

// Функция для отправки скриншота в Telegram
async function sendScreenshotToTelegram() {
  return new Promise(async (resolve) => {
    const dateVal = document.getElementById('date').value;
    if (!dateVal) { 
      alert("Выберите дату!");
      resolve(false);
      return;
    }

    const CHAT_ID = localStorage.getItem(STORAGE_CHAT_ID);
    console.log('Отправка в Telegram для Chat ID:', CHAT_ID);

    // Создаем временный контейнер для скриншота с правильными размерами
    const tempDiv = document.createElement('div');
    tempDiv.style.cssText = `
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      z-index: 10000;
      padding: 20px;
      overflow: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    `;

    // Создаем заголовок с датой
    const dateHeader = document.createElement('h1');
    dateHeader.textContent = `Дата: ${dateVal}`;
    dateHeader.style.cssText = `
      font-size: 28px;
      font-weight: bold;
      text-align: center;
      margin: 10px 0 20px 0;
      width: 100%;
    `;
    tempDiv.appendChild(dateHeader);

    // Создаем таблицу с правильными размерами
    const table = document.createElement('table');
    table.style.cssText = `
      border-collapse: collapse;
      width: 95%;
      font-size: 18px;
      margin: 0 auto;
    `;

    // Создаем заголовок таблицы
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    
    const headers = ['#', 'Имя', 'Был'];
    headers.forEach(text => {
      const th = document.createElement('th');
      th.textContent = text;
      th.style.cssText = `
        border: 2px solid #000;
        padding: 12px 8px;
        text-align: center;
        background-color: #f0f0f0;
        font-weight: bold;
        font-size: 20px;
      `;
      headerRow.appendChild(th);
    });
    
    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Создаем тело таблицы
    const tbody = document.createElement('tbody');
    const checks = Array.from(document.querySelectorAll('.studentCheck')).map(cb => cb.checked);

    studentNames.forEach((name, index) => {
      const row = document.createElement('tr');
      
      // Номер
      const tdNum = document.createElement('td');
      tdNum.textContent = index + 1;
      tdNum.style.cssText = `
        border: 1px solid #000;
        padding: 8px 4px;
        text-align: center;
        font-weight: bold;
        width: 50px;
      `;
      row.appendChild(tdNum);

      // Имя
      const tdName = document.createElement('td');
      tdName.textContent = name;
      tdName.style.cssText = `
        border: 1px solid #000;
        padding: 8px 12px;
        text-align: left;
        min-width: 500px;
        font-size: 16px;
      `;
      row.appendChild(tdName);

      // Отметка
      const tdCheck = document.createElement('td');
      tdCheck.style.cssText = `
        border: 1px solid #000;
        padding: 8px 4px;
        text-align: center;
        width: 80px;
        font-weight: bold;
        font-size: 20px;
      `;
      
      const status = checks[index] ? '+' : '-';
      tdCheck.textContent = status;
      tdCheck.style.color = checks[index] ? 'green' : 'red';
      
      row.appendChild(tdCheck);
      tbody.appendChild(row);
    });

    table.appendChild(tbody);
    tempDiv.appendChild(table);
    document.body.appendChild(tempDiv);

    try {
      // Даем время для рендера
      await new Promise(r => setTimeout(r, 500));

      const canvas = await html2canvas(tempDiv, {
        scale: 2,
        useCORS: true,
        backgroundColor: '#ffffff',
        logging: false,
        width: tempDiv.scrollWidth,
        height: tempDiv.scrollHeight,
        windowWidth: tempDiv.scrollWidth,
        windowHeight: tempDiv.scrollHeight
      });

      const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
      
      // Отправляем в Telegram
      const formData = new FormData();
      formData.append('chat_id', CHAT_ID);
      formData.append('photo', blob, 'attendance.png');
      formData.append('caption', `Посещаемость за ${dateVal}`);

      const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
        method: 'POST',
        body: formData
      });

      const result = await response.json();
      console.log('Результат отправки в Telegram:', result);

      if (response.ok) {
        showResult('✅ Скриншот отправлен в Telegram!', 'success');
        resolve(true);
      } else {
        showResult('❌ Ошибка отправки в Telegram', 'error');
        resolve(false);
      }

    } catch (error) {
      console.error('Ошибка отправки в Telegram:', error);
      showResult('❌ Ошибка отправки в Telegram', 'error');
      resolve(false);
    } finally {
      // Убираем временный контейнер
      tempDiv.remove();
    }
  });
}

// Сохраняет данные и отправляет в Telegram
async function saveAttendanceDataAndSend(date) {
  showResult('Сохранение данных...', 'info');
  
  try {
    // Сначала сохраняем в Firebase
    await saveAttendanceData(date);
    
    // Затем отправляем в Telegram
    await sendScreenshotToTelegram();
    
  } catch (error) {
    console.error('Общая ошибка:', error);
    showResult('❌ Ошибка при сохранении и отправке', 'error');
  }
}

// Показывает результат операции
function showResult(message, type) {
  const resultElement = document.getElementById('result');
  resultElement.textContent = message;
  resultElement.className = type;
  
  setTimeout(() => {
    resultElement.textContent = '';
    resultElement.className = '';
  }, 5000);
}

// Запускаем приложение при загрузке страницы
document.addEventListener('DOMContentLoaded', initApp);
</script>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
}

.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.login-box {
  background: white;
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  width: 100%;
  max-width: 400px;
  text-align: center;
}

.login-box h2 {
  margin-bottom: 20px;
  color: #333;
}

.role-selector {
  display: flex;
  margin-bottom: 20px;
  border-radius: 8px;
  overflow: hidden;
  border: 2px solid #667eea;
}

.role-btn {
  flex: 1;
  padding: 10px;
  border: none;
  background: white;
  cursor: pointer;
  transition: all 0.3s;
}

.role-btn.active {
  background: #667eea;
  color: white;
}

.login-form input {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 16px;
}

.login-form button {
  width: 100%;
  padding: 12px;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s;
}

.login-form button:hover {
  background: #5a6fd8;
}

.error-message {
  color: #e74c3c;
  margin-top: 10px;
  min-height: 20px;
}

.login-hint {
  margin-top: 20px;
  font-size: 12px;
  color: #666;
  line-height: 1.4;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  overflow: hidden;
}

header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

header h1 {
  margin: 0;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 15px;
}

#logoutBtn {
  background: rgba(255,255,255,0.2);
  color: white;
  border: 1px solid rgba(255,255,255,0.3);
  padding: 8px 15px;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s;
}

#logoutBtn:hover {
  background: rgba(255,255,255,0.3);
}

main {
  padding: 20px;
}

.date-section {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.date-section label {
  font-weight: bold;
  font-size: 16px;
}

#date {
  padding: 8px 12px;
  border: 2px solid #ddd;
  border-radius: 5px;
  font-size: 16px;
}

#saveBtn {
  background: #27ae60;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
  transition: background 0.3s;
}

#saveBtn:hover {
  background: #219a52;
}

#table-container {
  width: 100%;
  max-height: 70vh;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 8px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

th, td {
  border: 1px solid #ddd;
  padding: 12px 8px;
  text-align: left;
}

th {
  background: #f8f9fa;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 10;
}

td.num {
  width: 50px;
  text-align: center;
  font-weight: bold;
}

td.name {
  min-width: 300px;
}

td.checkbox {
  width: 100px;
  text-align: center;
}

.label-text {
  display: block;
  margin-bottom: 5px;
}

.top-checkbox {
  transform: scale(1.3);
}

.status-indicator {
  font-size: 18px;
  font-weight: bold;
}

.status-indicator.present {
  color: #27ae60;
}

.status-indicator.absent {
  color: #e74c3c;
}

#result {
  margin-top: 15px;
  padding: 10px;
  border-radius: 5px;
  text-align: center;
  font-weight: bold;
  min-height: 20px;
}

#result.success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

#result.error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

#result.warning {
  background: #fff3cd;
  color: #856404;
  border: 1px solid #ffeaa7;
}

#result.info {
  background: #d1ecf1;
  color: #0c5460;
  border: 1px solid #bee5eb;
}

@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  .login-box {
    padding: 20px;
  }
  
  header {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .date-section {
    flex-direction: column;
    align-items: stretch;
  }
  
  #date, #saveBtn {
    width: 100%;
  }
  
  td.name {
    min-width: 200px;
  }
}
</style>
</head>
<body>
<!-- Контент будет сгенерирован JavaScript -->
</body>
</html>
